<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="icon" type="image/png" href="./images/logoapp.png" />
    <link rel="stylesheet" href="/stylesheets/admincss.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer"
    />
    <link href="https://fonts.cdnfonts.com/css/be-vietnam-pro" rel="stylesheet">
    <title>Main</title>
</head>

<body>
    <div class="container__main">
        <div class="container__sidebar">
            <div class="sidebar__logo">
                <img src="/images/admin/logo.png" alt="">
            </div>
            <hr>
            <div class="sidebar-item">
                <div class="sideabar__top">
                    <a href="/admin/manageraccount">
                        Quản lý tài khoản
                    </a>
                    <a href="/admin/managerquestions" class="active">
                        Quản lý câu hỏi
                    </a>
                    <a href="#">
                        Đăng Xuất
                    </a>
                </div>
            </div>

        </div>
        <div class="container__content">
            <header class="content__header">
                <div class="content__header__nav">
                    <div class="content__header__none"></div>
                    <div class="content-info">
                        <div class="content__header__info">
                            <p class="content__info__username">
                                <%=user.fullName%>
                            </p>
                            <p class="content__info__decentralization">Admin</p>
                        </div>
                        <div class="content__avt">

                        </div>
                    </div>
                </div>
            </header>
            <div class="content__content">
                <div class="content__button__wrapper">
                    <div class="search__box">
                        <input name="search_question" type="text" placeholder="Nhập tiêu đề câu hỏi để tìm kiếm">
                        <button class="search">
                            <img src="/images/admin/search.png" alt="">
                        </button>
                    </div>

                    <div class="option">
                        <div class="language__option">
                            <select id="language_select">
                                <option value="">Ngôn Ngữ</option>
                                <% typeLanguageLevels.forEach((typeLanguageLevel) => { %>
                                    <option value=<%= typeLanguageLevel.typeLanguage %>><%= typeLanguageLevel.typeLanguage.toUpperCase() %></option>
                                  <% }) %>
                            </select>
                        </div>
                        <div class="language__option">
                            <select id="level_select">
                                <option value="">Level</option>
                            </select>
                        </div>
                    </div>

                    <div class="content__button">
                        <button class="button__add_acc" id="add_ques">Thêm Mới</button>
                    </div>
                </div>

                <div class="content__table">
                    <div class="content__table__title">
                        <ul class="list__title">
                            <li>STT</li>
                            <li>Tiêu Đề</li>
                            <li>Ngôn Ngữ</li>
                            <li>Level</li>
                            <li>Thao Tác</li>
                        </ul>
                    </div>
                    <%index=0%>
                        <% questions.forEach(question => { %>
                            <%index++%>
                                <div class="content__table__item list__question" data-typelanguage="<%=question.typeLanguage%>" data-level="<%=question.level%>">
                                    <ul class="list__item">
                                        <li>
                                            <%=index%>
                                        </li>
                                        <li class="title">
                                            <%=question.title%>

                                        </li claas="typeLanguage">
                                        <li>
                                            <%=question.typeLanguage%>
                                        </li>
                                        <li class="level">
                                            <%=question.level%>
                                        </li>
                                        <li class="item__option">
                                            <button class="button__edit" id="edit_info">Chỉnh Sửa</button>
                                            <button class="button__del" id="msg_del">Xóa</button>
                                        </li>
                                    </ul>
                                </div>
                                <% }) %>
                </div>

                <!-- THÊM MỚI -->

                <div id="wrapper__popup__add__quesion">
                    <div id="popup__add__quesion">
                        <div class="popup__title__info">
                            <div></div>
                            <p>Thêm Mới Câu Hỏi</p>
                            <button class="close__msg" id="exit_add_question"><i class="fa-solid fa-xmark"></i></button>
                        </div>
                        <div class="popup__content__info">
                            <div class="info__detail__ques__1">
                                <label for="">Tiêu đề: </label>
                                <input type="text" placeholder="Nội dung câu hỏi">
                            </div>
                            <div class="info__detail__ques__1">
                                <label for="">Ngôn Ngữ: </label>
                                <div class="language__option">
                                    <select id="language_select_on_add">
                                        <option value="">Ngôn Ngữ</option>
                                        <% typeLanguageLevels.forEach((typeLanguageLevel) => { %>
                                            <option value=<%= typeLanguageLevel.typeLanguage %>><%= typeLanguageLevel.typeLanguage.toUpperCase() %></option>
                                          <% }) %>
                                    </select>
                                </div>
                            </div>

                            <div class="info__detail__ques__1">
                                <label for="">Cấp độ: </label>
                                <div class="language__option">
                                    <select id="level_select_on_add">
                                    <option value="">Level</option>
                                </select>
                                </div>
                            </div>
                            <div class="info__detail__ques__1">
                                <label for="">Đáp Án: </label>
                                <div class="answer">
                                    <div class="answer__1">
                                        <div class="ans_1">
                                            <input type="text" placeholder="Nội dung câu hỏi">
                                            <input type="radio">
                                        </div>

                                        <div class="ans_1">
                                            <input type="text" placeholder="Nội dung câu hỏi">
                                            <input type="radio">
                                        </div>
                                    </div>
                                    <div class="answer__2">
                                        <div class="ans_1">
                                            <input type="text" placeholder="Nội dung câu hỏi">
                                            <input type="radio">
                                        </div>

                                        <div class="ans_1">
                                            <input type="text" placeholder="Nội dung câu hỏi">
                                            <input type="radio">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="set__options">
                                <div class="info__detail__ques__1">
                                    <label for="">Điểm số </label>
                                    <input type="text" value="" class="level">
                                    <p class="level__text">Mặc định là 0</p>
                                </div>

                                <div class="info__detail__ques__1">
                                    <label for="">Thời gian: </label>
                                    <input type="text" value="" class="level">
                                    <div class="time">
                                        <p class="level__text">Tính theo giây(s)</p>
                                        <p class="level__text">Mặc định 10 giây</p>
                                    </div>
                                </div>
                            </div>

                            <div class="button__op1">
                                <button id="update">Thêm Mới</button>
                                <button class="cancel" id="exit_add_question1">Hủy</button>
                            </div>

                        </div>

                    </div>
                </div>

                <div id="wrapper__popup__accept">
                    <div id="popup__accept">
                        <div class="popup__title">
                            <img src="/images/admin/yes.png" alt="">
                            <p>Thông Báo </p>
                        </div>
                        <div class="popup__content">
                            <p>Thêm Mới Thành Công</p>
                            <div class="popup__op">
                                <button type="button" id="exit_msg">Thoát</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
        <script>
            $(document).ready(function() {
                var selectedLanguageObject = "";
                var selectedLevelObject = "";
                var selectedLanguageObjectToAddQuestion = "";
                var selectedLevelObjectToAddQuestion = "";

                //chọn cấp độ ở phần thêm câu hỏi
                $('#level_select_on_add').change(function() {
                    var selectedLanguage = $(this).val();
                    selectedLevelObjectToAddQuestion = selectedLanguage;
                    console.log(selectedLanguageObjectToAddQuestion + "   " + selectedLevelObjectToAddQuestion);
                });

                //chọn ngôn ngữ
                $('#language_select_on_add').change(function() {
                    var selectedLanguage = $(this).val();
                    var typeLanguageLevels = JSON.parse('<%- JSON.stringify(typeLanguageLevels) %>');
                    var selectedLevels = typeLanguageLevels.find(function(typeLanguageLevel) {
                        return typeLanguageLevel.typeLanguage == selectedLanguage;
                    });
                    if (selectedLevels) {
                        selectedLanguageObjectToAddQuestion = selectedLanguage;
                        selectedLevelObjectToAddQuestion = "1";
                        var levelSelect = $('#level_select_on_add');
                        levelSelect.empty();
                        console.log(selectedLanguageObjectToAddQuestion + "   " + selectedLevelObjectToAddQuestion);
                        // Thêm các option tương ứng với các level
                        selectedLevels.levels.forEach(function(level) {
                            levelSelect.append($('<option>', {
                                value: level,
                                text: level
                            }));
                        });
                    } else {
                        selectedLanguageObjectToAddQuestion = "";
                        selectedLevelObjectToAddQuestion = "";
                        var levelSelect = $('#level_select_on_add');
                        levelSelect.empty();
                        levelSelect.append($('<option>', {
                            value: "",
                            text: "Level"
                        }));
                        console.log(selectedLanguageObjectToAddQuestion + "   " + selectedLevelObjectToAddQuestion);
                    }
                });
                $("#add_ques").on("click", function() {
                    $("#wrapper__popup__add__quesion").addClass("open__popup");
                });
                $("#exit_add_question").on("click", function() {
                    $("#wrapper__popup__add__quesion").removeClass("open__popup");
                });
                $("#exit_add_question1").on("click", function() {
                    $("#wrapper__popup__add__quesion").removeClass("open__popup");
                });
                // Lắng nghe sự kiện thay đổi giá trị của input
                $("input[name='search_question']").on("input", function() {
                    filterQuestions();
                });
                //chọn cấp độ
                $('#level_select').change(function() {
                    var selectedLanguage = $(this).val();
                    selectedLevelObject = selectedLanguage;
                    console.log(selectedLanguageObject + "   " + selectedLevelObject);
                    filterQuestions();
                });

                //chọn ngôn ngữ
                $('#language_select').change(function() {
                    var selectedLanguage = $(this).val();
                    var typeLanguageLevels = JSON.parse('<%- JSON.stringify(typeLanguageLevels) %>');

                    // Lọc danh sách typeLanguageLevels để tìm các level tương ứng
                    var selectedLevels = typeLanguageLevels.find(function(typeLanguageLevel) {
                        return typeLanguageLevel.typeLanguage == selectedLanguage;
                    });
                    if (selectedLevels) {
                        selectedLanguageObject = selectedLanguage;
                        selectedLevelObject = "1";
                        var levelSelect = $('#level_select');
                        levelSelect.empty();
                        console.log(selectedLanguageObject + "   " + selectedLevelObject);
                        // Thêm các option tương ứng với các level
                        selectedLevels.levels.forEach(function(level) {
                            levelSelect.append($('<option>', {
                                value: level,
                                text: level
                            }));
                        });
                        filterQuestions();
                    } else {
                        selectedLanguageObject = "";
                        selectedLevelObject = "";
                        var levelSelect = $('#level_select');
                        levelSelect.empty();
                        levelSelect.append($('<option>', {
                            value: "",
                            text: "Level"
                        }));
                        console.log(selectedLanguageObject + "   " + selectedLevelObject);
                        filterQuestions();
                    }

                });
                // lọc câu hỏi
                function filterQuestions() {
                    var searchValue = $("input[name='search_question']").val().trim().toLowerCase();

                    $('.content__table__item').each(function() {
                        var typeLanguage = $(this).data('typelanguage');
                        var level = $(this).data('level');
                        var title = $(this).find(".title").text().trim().toLowerCase();
                        console.log(title.includes(searchValue));
                        // Kiểm tra nếu giá trị email chứa giá trị tìm kiếm và đáp ứng cả điều kiện lọc ngôn ngữ và cấp độ
                        if ((searchValue == "" || title.includes(searchValue)) &&
                            (selectedLanguageObject == "" || selectedLanguageObject == typeLanguage) &&
                            (selectedLevelObject == "" || selectedLevelObject == level)) {
                            $(this).show();
                        } else {
                            $(this).hide();
                        }
                    });
                }
            });
        </script>
</body>

</html>